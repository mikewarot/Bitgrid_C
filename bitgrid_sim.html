<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitgrid Simulator</title>
    <style>
        .bit-grid {
            display: flex;
            gap: 10px;
        }
        .bit-grid input {
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>Bitgrid Simulator</h1>
    
    <div>
        <h2>4-bit Input</h2>
        <div class="bit-grid" id="bit-input">
            <input type="checkbox" id="bit3">
            <input type="checkbox" id="bit2">
            <input type="checkbox" id="bit1">
            <input type="checkbox" id="bit0">
        </div>
        <p>Index (Hex): <span id="index-hex">0</span></p>
    </div>
    
    <div>
        <h2>16-bit LUT Input</h2>
        <div class="bit-grid" id="lut-input">
            <input type="checkbox" id="lut0">
            <input type="checkbox" id="lut1">
            <input type="checkbox" id="lut2">
            <input type="checkbox" id="lut3">
            <input type="checkbox" id="lut4">
            <input type="checkbox" id="lut5">
            <input type="checkbox" id="lut6">
            <input type="checkbox" id="lut7">
            <input type="checkbox" id="lut8">
            <input type="checkbox" id="lut9">
            <input type="checkbox" id="lut10">
            <input type="checkbox" id="lut11">
            <input type="checkbox" id="lut12">
            <input type="checkbox" id="lut13">
            <input type="checkbox" id="lut14">
            <input type="checkbox" id="lut15">
        </div>
        <p>LUT (Hex): <span id="lut-hex">0</span></p>
        <p>LUT Description: <span id="lut-desc">nop</span></p>
    </div>
    
    <!-- Example input for logical expression -->
    <div>
        <label for="logical-expression">Logical Expression:</label>
        <input type="text" id="logical-expression" placeholder="Enter logical expression (e.g., A & B | ~C & D)">
        <button onclick="compileExpressionToLUT()">Compile</button>
    </div>

    <!-- Example output elements -->
    <div id="outputs">
        <h3>LUT Bits (Hex)</h3>
        <span id="lut-hex"></span>
        <h3>LUT Description</h3>
        <span id="lut-desc"></span>
    </div>

    <script>
        function compileExpressionToLUT() {
            const expression = document.getElementById('logical-expression').value;
            const lut = new Array(16).fill(0);

            for (let i = 0; i < 16; i++) {
                const A = (i & 1) !== 0;
                const B = (i & 2) !== 0;
                const C = (i & 4) !== 0;
                const D = (i & 8) !== 0;

                const evalExpression = expression
                    .replace(/A/g, A)
                    .replace(/B/g, B)
                    .replace(/C/g, C)
                    .replace(/D/g, D)
                    .replace(/~/g, '!')
                    .replace(/&/g, '&&')
                    .replace(/\|/g, '||');

                lut[i] = eval(evalExpression) ? 1 : 0;
            }

            // Convert LUT bits to hex
            let lutbits = 0;
            for (let i = 0; i < 16; i++) {
                lutbits |= (lut[i] << i);
            }
            document.getElementById('lut-hex').innerText = lutbits.toString(16).toUpperCase();

            // Compute a description of the LUT bits as a logical expression of the input bits
            let lutDesc = '';
            for (let i = 0; i < 16; i++) {
                if (lut[i] === 1) {
                    let term = '';
                    for (let j = 0; j < 4; j++) {
                        if ((i & (1 << j)) !== 0) {
                            term += `bit${j}`;
                        } else {
                            term += `~bit${j}`;
                        }
                        if (j < 3) {
                            term += ' & ';
                        }
                    }
                    if (lutDesc.length > 0) {
                        lutDesc += ' | ';
                    }
                    lutDesc += `(${term})`;
                }
            }
            document.getElementById('lut-desc').innerText = lutDesc; // Update the description of the LUT bits
        }
    </script>
</body>
</html>